<!doctype html>
<html lang="de">
<head>
    <!-- Meta-Angaben fÃ¼r Zeichensatz und responsive Design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PID-Regelung â€“ Raspberry Pi</title>

    <!-- Einbindung externer CSS- und JS-Bibliotheken -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Interne CSS-Styles fÃ¼r das Layout und Design -->
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
            background-color: #fff;
            color: #000;
        }
        /* Design fÃ¼r Statusanzeige */
        .status-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .active-box {
            background-color: #e0ffe0;
            border: 2px solid green;
            color: green;
        }
        .inactive-box {
            background-color: #f0f0f0;
            border: 2px solid #ccc;
            color: gray;
        }
        .status-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .dot-green { background-color: green; }
        .dot-gray { background-color: gray; }

        /* Tab-Buttons zur Navigation */
        .tab-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-buttons button {
            padding: 10px 20px;
            border: none;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .tab-buttons button:hover { background-color: #0056b3; }

        /* Anzeigeinhalte der Tabs */
        .tab-content { display: none; max-width: 900px; margin: auto; }
        .tab-content.active { display: block; }

        /* Design fÃ¼r Diagramme */
        .chart-container { width: 100%; height: 300px; }

        /* Tabellenformatierung */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #ccc; }
        th { background-color: #f5f5f5; }

        /* Eingabefelder */
        input[type="text"], input[type="number"] {
            padding: 8px; margin: 5px;
        }
        button {
            padding: 8px; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; font-size: 0.9em;
        }

        /* Bereich fÃ¼r Statusmeldungen */
        .status-log {
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            height: 150px;
            overflow-y: auto;
            padding: 5px;
            text-align: left;
            font-size: 0.9em;
        }
    </style>
</head>
<body data-logging="{{ 'true' if logging else 'false' }}" data-logstart="{{ log_start_time if log_start_time else '' }}">
    <!-- Anzeige des Logging-Status -->
    <h2 class="status-box inactive-box" id="loggingStatusBox">
        <span class="status-dot dot-gray"></span>
        <span id="loggingStatusText">Protokollierung inaktiv</span>
    </h2>

    <!-- Navigationsleiste fÃ¼r Tabs -->
    <div class="tab-buttons">
        <button onclick="showTab('live')">ğŸ“Š Live</button>
        <button onclick="showTab('logging')">ğŸ“ Protokollierung</button>
        <button onclick="showTab('settings')">âš™ï¸ Einstellungen</button>
        <button onclick="showTab('status')">ğŸ“‹ Status</button>
    </div>

    <!-- Inhalt des "Live"-Tabs -->
    <div id="live" class="tab-content active">
        <!-- Anzeige der aktuellen Messwerte -->
        <div id="measurement">
            <p>ğŸ•’ Zeit: <span id="timestampValue">--</span></p>
            <p>ğŸ¯ Sollwert: <span id="setpointValue">--</span> Â°C</p>
            <p>
                ğŸŒ¡ï¸ Istwert: <span id="inputValue">--</span> Â°C
                (Ã˜ <span id="avgInputValue">--</span> Â°C <span id="trendArrow">â†’</span>)
            </p>
            <p>ğŸŒ€ PWM: <span id="pwmValue">--</span> %</p>
            <p>ğŸ’¨ Volumenstrom: <span id="flowrateValue">--</span> mÂ³/h</p>
        </div>

        <!-- Diagramm zur Visualisierung der Werte -->
        <h2>
            ğŸ“Š Live-Diagramm
            <select id="zoomSelect" onchange="changeZoomLevel()" style="font-size: 0.5em; padding: 2px 6px; margin-left: 10px; border-radius: 4px; border: 1px solid #ccc;">
                <option value="10">10 Werte</option>
                <option value="50">50 Werte</option>
                <option value="150">150 Werte</option>
                <option value="300" selected>300 Werte</option>
            </select>
        </h2>
        <div class="chart-container">
            <canvas id="dataChart"></canvas>
        </div>

        <!-- Bereich zur manuellen Temperaturmessung -->
        <h2>ğŸŒ¡ï¸ Temperaturmessung</h2>
        <div style="margin-bottom: 10px;">
            <button onclick="startTempProbe()">ğŸ” Messung starten</button>
            <button onclick="stopTempProbe()">ğŸ›‘ Messung stoppen</button>
        </div>
        <div id="tempProbeStats">
            <p>ğŸ”» Min: <span id="probeMin">--</span> Â°C</p>
            <p>ğŸ”º Max: <span id="probeMax">--</span> Â°C</p>
            <p>Ã˜ Durchschnitt: <span id="probeAvg">--</span> Â°C</p>
            <p>ğŸ–¹ Anzahl Messwerte: <span id="probeCount">0</span></p>
        </div>
    </div>

    <!-- Inhalt des "Protokollierung"-Tabs -->
    <div id="logging" class="tab-content">
        <h2>ğŸ“ Protokollierung</h2>
        <div id="loggingControls">
            <form id="startLoggingForm" onsubmit="startLogging(event)" style="display: block;">
                <input type="text" name="log_name" placeholder="Log-Datei Name" required>
                <button type="submit">â–¶ï¸ Protokollierung starten</button>
            </form>
            <form id="stopLoggingForm" onsubmit="stopLogging(event)" style="display: none;">
                <button type="submit">â¹ Protokollierung stoppen</button>
            </form>
        </div>
        <p><a href="/logs">ğŸ“ Log-Verwaltung</a></p>

        <!-- Tabelle mit letzten Messwerten -->
        <h2>ğŸ“ˆ Letzte Messungen</h2>
        <table>
            <thead>
                <tr>
                    <th>ğŸ•’ Zeit</th>
                    <th>ğŸ¯ Sollwert [Â°C]</th>
                    <th>ğŸŒ¡ï¸ Istwert [Â°C]</th>
                    <th>ğŸŒ€ PWM [%]</th>
                    <th>ğŸ’¨ Volumenstrom [mÂ³/h]</th>
                </tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>
    </div>

    <!-- Inhalt des "Einstellungen"-Tabs -->
    <div id="settings" class="tab-content">
        <h2>ğŸ¯ Sollwert Ã¤ndern</h2>
        <form id="setpointForm" onsubmit="sendSetpoint(event)">
            <input type="text" name="setpoint" placeholder="Temperatur in Â°C" required>
            <button type="submit">âœ… Senden</button>
        </form>

        <!-- PID-Parameter-Eingabe -->
        <h2>âš™ï¸ PID Parameter Ã¤ndern</h2>
        <form id="pidForm" onsubmit="sendPid(event)">
            <input type="text" name="kp" id="kp" placeholder="Kp" required>
            <input type="text" name="ki" id="ki" placeholder="Ki" required>
            <input type="text" name="kd" id="kd" placeholder="Kd" required>
            <button type="submit">âœ… Senden</button>
        </form>

        <!-- Umschalten zwischen Auto- und Manuell-Modus -->
        <h2>ğŸ› ï¸ Betriebsmodus</h2>
        <select id="modeSelect" onchange="changeMode()">
            <option value="auto">Automatik</option>
            <option value="manual">Manuell</option>
        </select>

        <!-- Nur im manuellen Modus sichtbar -->
        <div id="manualControls" style="display:none;">
            <h2>ğŸŒ€ Manuelle PWM-Steuerung</h2>
            <form id="manualPwmForm" onsubmit="setManualPwm(event)">
                <input type="number" name="manual_pwm" min="0" max="100" placeholder="PWM (%)" required>
                <button type="submit">âœ… Senden</button>
            </form>
        </div>
    </div>

    <!-- Inhalt des "Status"-Tabs -->
    <div id="status" class="tab-content">
        <h2>ğŸ“‹ Statusmeldungen</h2>
        <div id="statusLog" class="status-log"></div>
        <button onclick="confirmReboot()">ğŸ” Raspberry Pi neu starten</button>
    </div>

    <!-- Tab-Anzeige-Logik -->
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }
    </script>

    <!-- Haupt-JavaScript-Datei mit Logik und Socket-Verbindungen -->
    <script src="/static/main.js"></script>
</body>
</html>
